<%- include('partials/head') %>
<%- include('partials/navbar') %>

    <% 
        const categoryIcons = {
            music: 'fa-music', admin: 'fa-shield-halved', utility: 'fa-wrench',
            playlist: 'fa-list', filters: 'fa-sliders', general: 'fa-terminal'
        };
        const categoryColors = {
            music: 'from-primary-500 to-rose-500', admin: 'from-amber-500 to-orange-500',
            utility: 'from-blue-500 to-cyan-500', playlist: 'from-emerald-500 to-green-500',
            filters: 'from-violet-500 to-purple-500', general: 'from-gray-400 to-gray-500'
        };
        const catKeys = typeof categories !== 'undefined' ? Object.keys(categories) : [];
        const totalCommands = catKeys.reduce((sum, k) => sum + (categories[k]?.length || 0), 0);
    %>

    <!-- Commands Page -->
    <section class="relative py-12" x-data="commandsPage()">
        <!-- Ambient -->
        <div class="absolute top-0 right-0 w-[500px] h-[400px] bg-primary-500/5 rounded-full blur-[120px] pointer-events-none"></div>
        
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Header -->
            <div class="mb-10">
                <h1 class="text-4xl font-bold mb-3">Commands</h1>
                <p class="text-gray-400"><%= totalCommands %> commands across <%= catKeys.length %> categories</p>
            </div>

            <!-- Search & Filter Bar -->
            <div class="flex flex-col sm:flex-row gap-3 mb-8">
                <!-- Search -->
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                    <input x-model="search" 
                           type="text" 
                           placeholder="Search commands..." 
                           class="w-full pl-11 pr-4 py-3 bg-white/5 border border-white/10 rounded-xl text-sm focus:outline-none focus:border-primary-500/50 focus:bg-white/[0.07] transition-all placeholder:text-gray-600">
                </div>
                
                <!-- Category Tabs -->
                <div class="flex gap-1.5 overflow-x-auto pb-1 scrollbar-none">
                    <button @click="activeCategory = 'all'" 
                            :class="activeCategory === 'all' ? 'bg-primary-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white'"
                            class="px-4 py-3 rounded-xl text-sm font-medium whitespace-nowrap transition-all duration-200">
                        All
                    </button>
                    <% catKeys.forEach(cat => { %>
                    <button @click="activeCategory = '<%= cat %>'" 
                            :class="activeCategory === '<%= cat %>' ? 'bg-primary-500 text-white' : 'bg-white/5 text-gray-400 hover:bg-white/10 hover:text-white'"
                            class="px-4 py-3 rounded-xl text-sm font-medium whitespace-nowrap transition-all duration-200 flex items-center gap-2">
                        <i class="fas <%= categoryIcons[cat] || 'fa-terminal' %> text-xs"></i>
                        <%= cat.charAt(0).toUpperCase() + cat.slice(1) %>
                        <span class="text-xs opacity-70">(<%= categories[cat].length %>)</span>
                    </button>
                    <% }); %>
                </div>
            </div>

            <!-- Command Grid -->
            <div class="space-y-8">
                <% catKeys.forEach(cat => { %>
                <div x-show="(activeCategory === 'all' || activeCategory === '<%= cat %>') && filteredCount('<%= cat %>') > 0"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 translate-y-4"
                     x-transition:enter-end="opacity-100 translate-y-0">
                    
                    <!-- Category Header -->
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br <%= categoryColors[cat] || 'from-gray-400 to-gray-500' %> flex items-center justify-center">
                            <i class="fas <%= categoryIcons[cat] || 'fa-terminal' %> text-white text-xs"></i>
                        </div>
                        <h2 class="text-lg font-semibold"><%= cat.charAt(0).toUpperCase() + cat.slice(1) %></h2>
                        <div class="h-px flex-1 bg-white/5"></div>
                    </div>

                    <!-- Commands List -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <% categories[cat].forEach(cmd => { %>
                        <div x-show="matchesSearch('<%= cmd.name %>', '<%= (cmd.description || '').replace(/'/g, "\\'") %>')"
                             x-transition
                             class="group glass rounded-xl p-4 hover:bg-white/[0.06] hover:border-white/10 transition-all duration-300">
                            <div class="flex items-start justify-between gap-3">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center gap-2 mb-1.5">
                                        <span class="cmd-tag">/<%= cmd.name %></span>
                                    </div>
                                    <p class="text-sm text-gray-400 leading-relaxed"><%= cmd.description || 'No description' %></p>
                                    <% if (cmd.options && cmd.options.length > 0) { %>
                                    <div class="flex flex-wrap gap-1.5 mt-2.5">
                                        <% cmd.options.forEach(opt => { %>
                                        <span class="text-[11px] px-2 py-0.5 rounded-md bg-white/5 text-gray-500 border border-white/5">
                                            <%= opt.name %><% if (opt.required) { %><span class="text-primary-400">*</span><% } %>
                                        </span>
                                        <% }); %>
                                    </div>
                                    <% } %>
                                </div>
                                <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-gray-500 group-hover:text-primary-400 group-hover:bg-primary-500/10 transition-all">
                                    <i class="fas fa-chevron-right text-xs"></i>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>
                <% }); %>
            </div>

            <!-- Empty State -->
            <div x-show="noResults" class="text-center py-20">
                <div class="w-16 h-16 rounded-2xl bg-white/5 flex items-center justify-center mx-auto mb-5">
                    <i class="fas fa-search text-2xl text-gray-600"></i>
                </div>
                <h3 class="text-xl font-semibold mb-2">No commands found</h3>
                <p class="text-gray-400 text-sm">Try a different search term</p>
            </div>
        </div>
    </section>

    <script>
        function commandsPage() {
            return {
                search: '',
                activeCategory: 'all',
                get noResults() {
                    if (!this.search) return false;
                    const s = this.search.toLowerCase();
                    const cats = <%- JSON.stringify(categories || {}) %>;
                    return !Object.values(cats).flat().some(c => 
                        c.name.toLowerCase().includes(s) || (c.description || '').toLowerCase().includes(s)
                    );
                },
                matchesSearch(name, desc) {
                    if (!this.search) return true;
                    const s = this.search.toLowerCase();
                    return name.toLowerCase().includes(s) || desc.toLowerCase().includes(s);
                },
                filteredCount(cat) {
                    const cats = <%- JSON.stringify(categories || {}) %>;
                    if (!this.search) return (cats[cat] || []).length;
                    const s = this.search.toLowerCase();
                    return (cats[cat] || []).filter(c => 
                        c.name.toLowerCase().includes(s) || (c.description || '').toLowerCase().includes(s)
                    ).length;
                }
            };
        }
    </script>

<%- include('partials/footer') %>
